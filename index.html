<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>êµìœ¡ ì´ìˆ˜ì¦ í†µí•© ê´€ë¦¬ ì‹œìŠ¤í…œ</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap');
        :root {
            --primary-color: #667eea;
            --secondary-color: #764ba2;
            --text-color: #333;
            --bg-color: #f8f9fa;
            --card-bg: #ffffff;
            --shadow: 0 4px 15px rgba(0,0,0,0.08);
        }
        body { font-family: 'Noto Sans KR', sans-serif; background-color: var(--bg-color); margin: 0; padding: 2rem; color: var(--text-color); }
        .container { max-width: 1000px; margin: auto; }
        .main-header { padding: 2rem; text-align: center; color: white; background: linear-gradient(135deg, var(--primary-color), var(--secondary-color)); border-radius: 12px; margin-bottom: 2rem; box-shadow: var(--shadow); }
        .main-header h1 { margin: 0; font-size: 2.5rem; }
        .main-header p { opacity: 0.9; margin: 0.5rem 0 0; }
        .card { background: var(--card-bg); padding: 2rem; border-radius: 12px; box-shadow: var(--shadow); margin-bottom: 2rem; }
        .card-title { font-size: 1.5rem; margin: 0 0 1.5rem 0; padding-bottom: 1rem; border-bottom: 1px solid #eee; }
        .form-group { margin-bottom: 1.5rem; }
        .form-group label { display: block; font-weight: 500; margin-bottom: 0.5rem; }
        .form-group input, .form-group textarea { width: 100%; padding: 0.8rem; border: 1px solid #ddd; border-radius: 8px; font-size: 1rem; box-sizing: border-box; }
        .form-group textarea { height: 120px; resize: vertical; }
        .btn { padding: 0.8rem 1.5rem; border: none; border-radius: 8px; cursor: pointer; font-size: 1rem; font-weight: 500; transition: all 0.2s ease; }
        .btn-primary { background-color: var(--primary-color); color: white; }
        .btn-primary:hover { background-color: #5a6fcf; }
        .btn-success { background-color: #28a745; color: white; }
        .btn-danger { background-color: #dc3545; color: white; }
        .btn-secondary { background: #6c757d; color: white; }
        .btn-info { background: #17a2b8; color: white; }
        .btn-sm { padding: 0.4rem 0.8rem; font-size: 0.8rem; }
        .action-buttons { display: flex; gap: 1rem; flex-wrap: wrap; }
        .mode-switcher { position: fixed; top: 20px; right: 20px; z-index: 100; }
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1.5rem; }
        .stat-card { background: var(--card-bg); padding: 1.5rem; border-radius: 12px; text-align: center; border-top: 4px solid var(--primary-color); box-shadow: var(--shadow); }
        .stat-number { font-size: 2.5rem; font-weight: 700; color: var(--primary-color); }
        .stat-label { font-size: 1rem; color: #666; }
        .participants-table { width: 100%; border-collapse: collapse; margin-top: 1.5rem; }
        .participants-table th, .participants-table td { padding: 1rem; border-bottom: 1px solid #eee; text-align: left; }
        .participants-table th { background-color: #f8f9fa; font-weight: 500; }
        #certificate-wrapper { display: none; padding: 2rem; margin-top: 2rem; background: white; position: relative; border: 1px solid #ddd; }
        #certificate-content { padding: 2rem; text-align: center; max-width: 680px; margin: auto; }
        .cert-header h2 { font-size: 2.5rem; font-weight: 700; margin: 0; letter-spacing: 0.2rem; }
        .cert-header p { font-size: 1.2rem; color: #555; margin-top: 0.5rem; letter-spacing: 0.1rem; }
        .cert-info { text-align: left; margin: 2.5rem 0; border-top: 1px solid #eee; border-bottom: 1px solid #eee; padding: 1.5rem 0; }
        .cert-info p { margin: 0.8rem 0; font-size: 1.1rem; }
        .cert-body { font-size: 1.1rem; line-height: 1.8; margin: 2.5rem 0; }
        .cert-date { font-size: 1.2rem; margin: 2.5rem 0; font-weight: 500; }
        .issuer-container { position: relative; display: inline-block; margin-top: 3rem; }
        .cert-issuer { font-size: 1.5rem; font-weight: 700; display: inline; padding-right: 60px; }
        .seal-image { position: absolute; right: -20px; top: 50%; transform: translateY(-60%); width: 100px; height: 100px; opacity: 0.9; }
        #admin-view { display: none; }
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); display: none; justify-content: center; align-items: center; z-index: 200; }
        .modal-content { background: white; padding: 2rem; border-radius: 12px; width: 90%; max-width: 400px; box-shadow: 0 5px 20px rgba(0,0,0,0.2); }
        .modal-content h2 { margin-top: 0; }
        .modal-buttons { display: flex; justify-content: flex-end; gap: 1rem; margin-top: 1.5rem; }
        @media print { body * { visibility: hidden; } #certificate-wrapper, #certificate-wrapper * { visibility: visible; } #certificate-wrapper { position: absolute; left: 0; top: 0; width: 100%; height: 100%; margin: 0; padding: 0; border: none !important; } }
    </style>
</head>
<body>
    <div class="container">
        <div id="user-view">
            <header class="main-header">
                <h1>êµìœ¡ ì´ìˆ˜ì¦ ë°œê¸‰</h1>
                <p>ì´ë©”ì¼ì„ ì…ë ¥í•˜ì—¬ ì´ìˆ˜ì¦ì„ ë°œê¸‰ë°›ìœ¼ì„¸ìš”.</p>
            </header>
            <div class="card" id="lookup-card">
                <div class="form-group">
                    <label for="email-input">ì´ë©”ì¼ ì£¼ì†Œ</label>
                    <input type="email" id="email-input" placeholder="ë“±ë¡ëœ ì´ë©”ì¼ ì£¼ì†Œë¥¼ ì…ë ¥í•˜ì„¸ìš”">
                </div>
                <button id="lookup-btn" class="btn btn-primary">ì´ìˆ˜ì¦ ì¡°íšŒí•˜ê¸°</button>
                <div id="user-message" style="margin-top: 1rem; font-weight: 500;"></div>
            </div>
            <div id="certificate-wrapper" class="no-print">
                <div id="certificate-content">
                    <div class="cert-header">
                        <h2>êµìœ¡ì´ìˆ˜ì¦</h2>
                        <p>CERTIFICATE</p>
                    </div>
                    <div class="cert-info">
                        <p>ì„±&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ëª…: <span id="cert-name-val" style="font-weight:bold;"></span></p>
                        <p>êµìœ¡ ê¸°ê°„: <span id="cert-period-val"></span></p>
                        <p>êµìœ¡ ê³¼ì •: <span id="cert-course-val"></span></p>
                    </div>
                    <p class="cert-body" id="cert-body-val"></p>
                    <p class="cert-date" id="cert-date-val"></p>
                    <div class="issuer-container">
                        <p class="cert-issuer" id="cert-issuer-val"></p>
                        <img id="seal-img" src="seal.png" alt="ê´€ì¸" class="seal-image" onerror="this.style.display='none'">
                    </div>
                </div>
            </div>
            <div class="card no-print action-buttons" id="print-card" style="display:none;">
                 <button onclick="window.print()" class="btn btn-success">ğŸ–¨ï¸ ì¸ì‡„í•˜ê¸°</button>
            </div>
        </div>
        <div id="admin-view">
            <header class="main-header">
                <h1>ğŸ“ ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ</h1>
                <p>êµìœ¡ì •ë³´, ì°¸ê°€ì ê´€ë¦¬ ë° ë°ì´í„°ë¥¼ ê´€ë¦¬í•©ë‹ˆë‹¤.</p>
            </header>
            <div class="card stats-grid">
                <div class="stat-card"><div class="stat-number" id="total-participants">0</div><div class="stat-label">ì´ ì°¸ê°€ì</div></div>
                <div class="stat-card"><div class="stat-number" id="issue-count">0</div><div class="stat-label">ì´ìˆ˜ì¦ ë°œê¸‰ íšŸìˆ˜</div></div>
            </div>
            <div class="card">
                <h2 class="card-title">ğŸ“š êµìœ¡ì •ë³´ ì„¤ì •</h2>
                <div class="form-group"><label for="course-name">êµìœ¡ ê³¼ì •ëª…</label><input type="text" id="course-name"></div>
                <div class="form-group"><label for="education-period">êµìœ¡ ê¸°ê°„ (ì˜ˆ: 2024ë…„ 7ì›” 10ì¼ ~ 7ì›” 12ì¼)</label><input type="text" id="education-period"></div>
                <div class="form-group"><label for="completion-date">ì´ìˆ˜ì¦ ë°œê¸‰ì¼</label><input type="date" id="completion-date"></div>
                <div class="form-group"><label for="host-org">ì£¼ê´€ ê¸°ê´€ (ë³¸ë¬¸ ë‚´ìš©ì— ì‚¬ìš©)</label><input type="text" id="host-org"></div>
                <div class="form-group"><label for="issuer-name">ë°œí–‰ ê¸°ê´€ëª…</label><input type="text" id="issuer-name"></div>
                <button id="save-edu-info-btn" class="btn btn-primary">ğŸ’¾ êµìœ¡ì •ë³´ ì €ì¥</button>
            </div>
            <div class="card">
                <h2 class="card-title">ğŸ‘¤ ì°¸ê°€ì ê°œë³„ ë“±ë¡</h2>
                <div class="form-group"><label for="participant-name">ì´ë¦„</label><input type="text" id="participant-name"></div>
                <div class="form-group"><label for="participant-email">ì´ë©”ì¼</label><input type="email" id="participant-email"></div>
                <button id="add-participant-btn" class="btn btn-success">â• ê°œë³„ ì¶”ê°€</button>
            </div>
            <div class="card">
                <h2 class="card-title">ğŸ“‹ ì°¸ê°€ì ì¼ê´„ ë“±ë¡</h2>
                <div class="form-group"><label for="bulk-input">ì°¸ê°€ì ëª©ë¡ (ì´ë¦„,ì´ë©”ì¼)</label><textarea id="bulk-input" placeholder="í™ê¸¸ë™,gildong@email.com\nê¹€ì² ìˆ˜,chulsoo@email.com"></textarea></div>
                <button id="bulk-add-btn" class="btn btn-primary">ğŸ“¥ ì¼ê´„ ë“±ë¡</button>
            </div>
            <div class="card">
                <h2 class="card-title">ğŸ‘¥ ë“±ë¡ëœ ì°¸ê°€ì ëª©ë¡</h2>
                <div style="overflow-x:auto;"><table class="participants-table"><thead><tr><th>ì´ë¦„</th><th>ì´ë©”ì¼</th><th>ì‚­ì œ</th></tr></thead><tbody id="admin-table-body"></tbody></table></div>
            </div>
            <div class="card">
                <h2 class="card-title">ğŸ’¾ ë°ì´í„° ê´€ë¦¬</h2>
                <p style="font-size:0.9rem; color:#555;">ì¤‘ìš”: í˜„ì¬ ëª¨ë“  ì •ë³´ëŠ” ë¸Œë¼ìš°ì €ì—ë§Œ ì €ì¥ë©ë‹ˆë‹¤. ë°ì´í„°ë¥¼ ë³´ì¡´í•˜ë ¤ë©´ ë°˜ë“œì‹œ ë°±ì—…í•˜ì„¸ìš”.</p>
                <div class="action-buttons">
                    <button id="backup-btn" class="btn btn-info">ğŸ“¥ ì „ì²´ ë°ì´í„° ë°±ì—…</button>
                    <button id="import-btn" class="btn btn-secondary">ğŸ“¤ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°</button>
                    <input type="file" id="import-file-input" accept=".json" style="display:none;">
                </div>
            </div>
        </div>
        <div class="mode-switcher no-print">
            <button id="mode-switch-btn" class="btn btn-secondary btn-sm">ê´€ë¦¬ì ëª¨ë“œ</button>
        </div>
    </div>
    <div id="password-modal" class="modal-overlay">
        <div class="modal-content">
            <h2>ê´€ë¦¬ì ë¡œê·¸ì¸</h2>
            <div class="form-group">
                <label for="password-input">ë¹„ë°€ë²ˆí˜¸</label>
                <input type="password" id="password-input">
            </div>
            <div id="modal-error-msg" style="color: #dc3545; font-size: 0.9rem; height: 1rem;"></div>
            <div class="modal-buttons">
                <button id="modal-cancel-btn" class="btn btn-secondary">ì·¨ì†Œ</button>
                <button id="modal-login-btn" class="btn btn-primary">ë¡œê·¸ì¸</button>
            </div>
        </div>
    </div>
<script>
const AppState = {
    isAdminView: false,
    participants: [],
    educationInfo: {
        courseName: 'í•œêµ­ì‚¬ë¦½ëŒ€í•™êµë„ì„œê´€í˜‘ì˜íšŒ ì œ37ì°¨ ì‹¤ë¬´ì ì›Œí¬ìˆ',
        educationPeriod: '2024ë…„ 7ì›” 10ì¼ ~ 7ì›” 12ì¼ (12ì‹œê°„)',
        completionDate: '2024-07-12',
        hostOrg: 'ê²½í¬ëŒ€í•™êµ',
        issuerName: 'í•œêµ­ì‚¬ë¦½ëŒ€í•™êµë„ì„œê´€í˜‘ì˜íšŒ'
    },
    issueCount: 0
};
const DOMElements = {
    userView: document.getElementById('user-view'),
    adminView: document.getElementById('admin-view'),
    modeSwitchBtn: document.getElementById('mode-switch-btn'),
    emailInput: document.getElementById('email-input'),
    lookupBtn: document.getElementById('lookup-btn'),
    lookupCard: document.getElementById('lookup-card'),
    userMessage: document.getElementById('user-message'),
    certificateWrapper: document.getElementById('certificate-wrapper'),
    printCard: document.getElementById('print-card'),
    totalParticipantsEl: document.getElementById('total-participants'),
    issueCountEl: document.getElementById('issue-count'),
    courseNameInput: document.getElementById('course-name'),
    educationPeriodInput: document.getElementById('education-period'),
    completionDateInput: document.getElementById('completion-date'),
    hostOrgInput: document.getElementById('host-org'),
    issuerNameInput: document.getElementById('issuer-name'),
    saveEduInfoBtn: document.getElementById('save-edu-info-btn'),
    participantNameInput: document.getElementById('participant-name'),
    participantEmailInput: document.getElementById('participant-email'),
    addParticipantBtn: document.getElementById('add-participant-btn'),
    bulkInput: document.getElementById('bulk-input'),
    bulkAddBtn: document.getElementById('bulk-add-btn'),
    adminTableBody: document.getElementById('admin-table-body'),
    backupBtn: document.getElementById('backup-btn'),
    importBtn: document.getElementById('import-btn'),
    importFileInput: document.getElementById('import-file-input'),
    passwordModal: document.getElementById('password-modal'),
    passwordInput: document.getElementById('password-input'),
    modalErrorMsg: document.getElementById('modal-error-msg'),
    modalLoginBtn: document.getElementById('modal-login-btn'),
    modalCancelBtn: document.getElementById('modal-cancel-btn'),
};
const Storage = {
    save: () => localStorage.setItem('app_data_v2', JSON.stringify(AppState)),
    load: () => {
        const data = localStorage.getItem('app_data_v2');
        if (data) {
            const parsedData = JSON.parse(data);
            Object.assign(AppState, parsedData);
        }
    }
};
const UI = {
    init: () => {
        DOMElements.userView.style.display = 'block';
        DOMElements.adminView.style.display = 'none';
        DOMElements.modeSwitchBtn.textContent = 'ê´€ë¦¬ì ëª¨ë“œ';
        AppState.isAdminView = false;
    },
    toggleView: () => {
        AppState.isAdminView = !AppState.isAdminView;
        if (AppState.isAdminView) {
            DOMElements.userView.style.display = 'none';
            DOMElements.adminView.style.display = 'block';
            DOMElements.modeSwitchBtn.textContent = 'ì‚¬ìš©ì ëª¨ë“œ';
            UI.renderAdminDashboard();
        } else {
            DOMElements.userView.style.display = 'block';
            DOMElements.adminView.style.display = 'none';
            DOMElements.modeSwitchBtn.textContent = 'ê´€ë¦¬ì ëª¨ë“œ';
        }
    },
    renderAdminDashboard: () => {
        DOMElements.totalParticipantsEl.textContent = AppState.participants.length;
        DOMElements.issueCountEl.textContent = AppState.issueCount;
        DOMElements.courseNameInput.value = AppState.educationInfo.courseName;
        DOMElements.educationPeriodInput.value = AppState.educationInfo.educationPeriod;
        DOMElements.completionDateInput.value = AppState.educationInfo.completionDate;
        DOMElements.hostOrgInput.value = AppState.educationInfo.hostOrg;
        DOMElements.issuerNameInput.value = AppState.educationInfo.issuerName;
        UI.renderParticipantTable();
    },
    renderParticipantTable: () => {
        DOMElements.adminTableBody.innerHTML = '';
        AppState.participants.forEach((p, index) => {
            const row = document.createElement('tr');
            row.innerHTML = `<td>${p.name}</td><td>${p.email}</td><td><button class="btn btn-danger btn-sm" data-index="${index}">ì‚­ì œ</button></td>`;
            DOMElements.adminTableBody.appendChild(row);
        });
    },
    displayUserMessage: (text, isError = false) => {
        DOMElements.userMessage.textContent = text;
        DOMElements.userMessage.style.color = isError ? '#dc3545' : '#28a745';
    },
    displayCertificate: (participant) => {
        document.getElementById('cert-name-val').textContent = participant.name;
        document.getElementById('cert-period-val').textContent = AppState.educationInfo.educationPeriod;
        document.getElementById('cert-course-val').textContent = AppState.educationInfo.courseName;
        document.getElementById('cert-body-val').innerHTML = `ê·€í•˜ëŠ” í•œêµ­ì‚¬ë¦½ëŒ€í•™êµë„ì„œê´€í˜‘ì˜íšŒê°€ ì£¼ìµœí•˜ê³ <br>${AppState.educationInfo.hostOrg}ê°€ ì£¼ê´€í•œ ã€Œ${AppState.educationInfo.courseName}ã€ì˜<br>ì „ê³¼ì •ì„ ì„±ì‹¤íˆ ì´ìˆ˜í•˜ì˜€ê¸°ì— ì´ ì¦ì„œë¥¼ ë“œë¦½ë‹ˆë‹¤.`;
        document.getElementById('cert-date-val').textContent = new Date(AppState.educationInfo.completionDate).toLocaleDateString('ko-KR', { year: 'numeric', month: 'long', day: 'numeric' });
        document.getElementById('cert-issuer-val').textContent = AppState.educationInfo.issuerName;
        DOMElements.certificateWrapper.style.display = 'block';
        DOMElements.printCard.style.display = 'flex';
    },
    hideCertificate: () => {
        DOMElements.certificateWrapper.style.display = 'none';
        DOMElements.printCard.style.display = 'none';
    }
};
const Handlers = {
    handleModeSwitch: () => {
        if (!AppState.isAdminView) {
            DOMElements.passwordModal.style.display = 'flex';
            DOMElements.passwordInput.focus();
        } else UI.toggleView();
    },
    handleModalLogin: () => {
        const password = DOMElements.passwordInput.value;
        if (password === 'Postech@1986') {
            DOMElements.passwordModal.style.display = 'none';
            DOMElements.passwordInput.value = '';
            DOMElements.modalErrorMsg.textContent = '';
            UI.toggleView();
        } else {
            DOMElements.modalErrorMsg.textContent = 'ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤.';
        }
    },
    handleModalCancel: () => {
        DOMElements.passwordModal.style.display = 'none';
        DOMElements.passwordInput.value = '';
        DOMElements.modalErrorMsg.textContent = '';
    },
    handleLookup: () => {
        const email = DOMElements.emailInput.value.trim().toLowerCase();
        if (!email) { UI.displayUserMessage('ì´ë©”ì¼ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.', true); return; }
        const participant = AppState.participants.find(p => p.email.toLowerCase() === email);
        if (participant) {
            UI.displayUserMessage('ì´ìˆ˜ì¦ì´ í™•ì¸ë˜ì—ˆìŠµë‹ˆë‹¤. í•˜ë‹¨ì—ì„œ ë‚´ìš©ì„ í™•ì¸í•˜ê³  ì¸ì‡„í•˜ì„¸ìš”.');
            UI.displayCertificate(participant);
            DOMElements.lookupCard.style.display = 'none'; // Hide the lookup card on success
            AppState.issueCount++;
            Storage.save();
        } else {
            UI.displayUserMessage('ë“±ë¡ëœ ì´ë©”ì¼ì´ ì—†ìŠµë‹ˆë‹¤. ì‚¬ë¬´êµ­ì— ë¬¸ì˜í•´ì£¼ì„¸ìš”.', true);
            UI.hideCertificate();
            DOMElements.lookupCard.style.display = 'block'; // Ensure lookup card is visible on failure
        }
    },
    handleSaveEduInfo: () => {
        AppState.educationInfo.courseName = DOMElements.courseNameInput.value;
        AppState.educationInfo.educationPeriod = DOMElements.educationPeriodInput.value;
        AppState.educationInfo.completionDate = DOMElements.completionDateInput.value;
        AppState.educationInfo.hostOrg = DOMElements.hostOrgInput.value;
        AppState.educationInfo.issuerName = DOMElements.issuerNameInput.value;
        Storage.save();
        alert('êµìœ¡ì •ë³´ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
    },
    handleAddParticipant: () => {
        const name = DOMElements.participantNameInput.value.trim();
        const email = DOMElements.participantEmailInput.value.trim().toLowerCase();
        if (!name || !email) { alert('ì´ë¦„ê³¼ ì´ë©”ì¼ì„ ëª¨ë‘ ì…ë ¥í•´ì•¼ í•©ë‹ˆë‹¤.'); return; }
        if (AppState.participants.some(p => p.email === email)) { alert('ì´ë¯¸ ë“±ë¡ëœ ì´ë©”ì¼ì…ë‹ˆë‹¤.'); return; }
        AppState.participants.push({ name, email });
        Storage.save();
        UI.renderAdminDashboard();
        DOMElements.participantNameInput.value = '';
        DOMElements.participantEmailInput.value = '';
    },
    handleBulkAdd: () => {
        const lines = DOMElements.bulkInput.value.trim().split('\n');
        let addedCount = 0;
        lines.forEach(line => {
            const [name, email] = line.split(',').map(s => s.trim());
            if (name && email && !AppState.participants.some(p => p.email.toLowerCase() === email.toLowerCase())) {
                AppState.participants.push({ name, email: email.toLowerCase() });
                addedCount++;
            }
        });
        if (addedCount > 0) {
            Storage.save();
            UI.renderAdminDashboard();
            DOMElements.bulkInput.value = '';
            alert(`${addedCount}ëª…ì˜ ì°¸ê°€ìê°€ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.`);
        } else alert('ì¶”ê°€í•  ìœ íš¨í•œ ì°¸ê°€ìê°€ ì—†ê±°ë‚˜ ëª¨ë‘ ì¤‘ë³µëœ ì´ë©”ì¼ì…ë‹ˆë‹¤.');
    },
    handleTableClick: (e) => {
        if (e.target.classList.contains('btn-danger')) {
            const index = parseInt(e.target.dataset.index);
            if (confirm(`'${AppState.participants[index].name}' ì°¸ê°€ìë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
                AppState.participants.splice(index, 1);
                Storage.save();
                UI.renderAdminDashboard();
            }
        }
    },
    handleBackup: () => {
        const dataStr = JSON.stringify(AppState, null, 2);
        const blob = new Blob([dataStr], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `certificate_backup_${new Date().toISOString().slice(0,10)}.json`;
        a.click();
        URL.revokeObjectURL(url);
    },
    handleImport: () => DOMElements.importFileInput.click(),
    handleFileImport: (e) => {
        const file = e.target.files[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = (event) => {
            try {
                const importedData = JSON.parse(event.target.result);
                if (confirm('í˜„ì¬ ë°ì´í„°ë¥¼ ëª¨ë‘ ì§€ìš°ê³  ê°€ì ¸ì˜¨ ë°ì´í„°ë¡œ ë³µì›í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                    Object.assign(AppState, importedData);
                    Storage.save();
                    UI.renderAdminDashboard();
                    alert('ë°ì´í„°ë¥¼ ì„±ê³µì ìœ¼ë¡œ ë³µì›í–ˆìŠµë‹ˆë‹¤.');
                }
            } catch (err) { alert('ìœ íš¨í•˜ì§€ ì•Šì€ íŒŒì¼ í˜•ì‹ì…ë‹ˆë‹¤.'); }
        };
        reader.readAsText(file);
        DOMElements.importFileInput.value = '';
    }
};
document.addEventListener('DOMContentLoaded', () => {
    Storage.load();
    UI.init();
    DOMElements.modeSwitchBtn.addEventListener('click', Handlers.handleModeSwitch);
    DOMElements.lookupBtn.addEventListener('click', Handlers.handleLookup);
    DOMElements.emailInput.addEventListener('keyup', (event) => {
        if (event.key === 'Enter') Handlers.handleLookup();
    });
    DOMElements.saveEduInfoBtn.addEventListener('click', Handlers.handleSaveEduInfo);
    DOMElements.addParticipantBtn.addEventListener('click', Handlers.handleAddParticipant);
    DOMElements.bulkAddBtn.addEventListener('click', Handlers.handleBulkAdd);
    DOMElements.adminTableBody.addEventListener('click', Handlers.handleTableClick);
    DOMElements.backupBtn.addEventListener('click', Handlers.handleBackup);
    DOMElements.importBtn.addEventListener('click', Handlers.handleImport);
    DOMElements.importFileInput.addEventListener('change', Handlers.handleFileImport);
    DOMElements.modalLoginBtn.addEventListener('click', Handlers.handleModalLogin);
    DOMElements.modalCancelBtn.addEventListener('click', Handlers.handleModalCancel);
    DOMElements.passwordInput.addEventListener('keyup', (event) => {
        if (event.key === 'Enter') Handlers.handleModalLogin();
    });
});
</script>
</body>
</html>